<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="author" content="order by dede58.com"/>
    <title>Mutual商城-个人中心</title>
    <link rel="stylesheet" type="text/css" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap-fileinput.css">
    <script src="../static/js/js/jquery-3.2.1.js"></script>
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap-fileinput.js"></script>
    <link href="../static/css/p.css" rel="stylesheet" type="text/css">


</head>

<style>
    .gzxx {font-size: 12px;font-weight: bold;color:rgb(117,117,117);width: 100px;display: inline-block}

</style>
<body>



<div id="head"></div>

<div style="height: 50px"></div>


<div class="grzxbj">
    <div class="selfinfo center">
        <div class="lfnav fl" style="height: 1300px">
            <div class="ddzx" style="height: 20px">个人中心</div>
            <div class="subddzx">
                <ul>
                    <li><a href="./self_info.html" >我的信息</a></li>
                    <li><a href="./self_info_edit.html">修改信息</a></li>
                    <li><a href="./self_info_pwd_edit.html">修改密码</a></li>
                    <li><a href="./coupon.html">优惠券</a></li>
                    <li><a href="./address.html">收货地址</a></li>
                    <li><a href="./point.html">我的积分</a></li>
                </ul>
            </div>
            <div class="ddzx" style="height: 20px">订单中心</div>
            <div class="subddzx">
                <ul>
                    <li><a href="./orders.html">我的订单</a></li>
                    <li><a href="./basket.html">我的购物车</a></li>
                    <li><a href="./favourite.html">我的收藏</a></li>
                    <li><a href="./footprint.html">我的足迹</a></li>
                </ul>
            </div>
        </div>
        <div class="rtcont fr"  style="width: 978px;height: 1300px;background: #fff">
            <div class="grzlbt ml40" id="address">我的收货地址</div>
            <!--新增地址-->

            <div data-spm="1998049142" class="m-logistics g-box-base g-mb-set" >
                <div class="s-bar" >
                    <i class="s-icon"></i>新增地址
                </div>
                <div class="s-content" style="height: 500px">
                    <ul class="lg-list">
                        <li class="lg-item">
                            <form>
                                <div hidden><input id="uid" hidden ></div>
                                <!--<div class=" gzxx ml40" style="width: 550px" >-->
                                    <!--<span class="gzxx" style="padding-right: 30px">国家：</span>-->
                                    <!--<input type="text" id="country" style="height: 30px;width: 260px" placeholder="country">-->
                                <!--</div>-->
                                <!--<br/><br/>-->
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">省：</span>
                                    <input type="text" id="province" style="height: 30px;width: 260px" placeholder="province">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">市：</span>
                                    <input type="text" id="city" style="height: 30px;width: 260px" placeholder="city">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">区：</span>
                                    <input type="text" id="region" style="height: 30px;width: 260px" placeholder="region">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px" >详细地址：</span>
                                    <textarea id="detail_address" style="resize: none" rows="3" cols="40" placeholder="请输入详细地址信息，如道路、门牌号、小区、楼栋号、单元等信息"></textarea>
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">邮政编码：</span>
                                    <input type="text" id="post_code" style="height: 30px;width: 260px" placeholder="post_code">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">收货人姓名：</span>
                                    <input type="text" id="name" style="height: 30px;width: 260px" placeholder="name">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">收货人手机号码：</span>
                                    <input type="text" id="phone_number" style="height: 30px;width: 260px" placeholder="phone_number">
                                </div>
                                <br/><br/>
                                <div lass=" gzxx ml40">
                                    <span style="padding-right: 40px"></span>
                                    <button href="self_info_edit.html" onclick="addAddress()">保存</button>
                                </div>

                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            <!--遍历地址-->
            <div data-spm="1998049142" class="m-logistics g-box-base g-mb-set" >
                <div class="s-bar" >
                    <i class="s-icon"></i>我的地址
                </div>


                <div class="addressList">
                    <div class="next-table">

                    <table id="addressList">
                        <colgroup>
                            <col style="width: 70px;">
                            <col>
                            <col style="width: 200px;">
                            <col style="width: 100px;">
                            <col style="width: 140px;">
                            <col style="width: 110px;">
                            <col style="width: 90px;">
                        </colgroup>
                        <thead class="next-table-header">
                        <tr>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell" style="width: 60px">
                                <div class="next-table-cell-wrapper">收货人</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell" style="width: 150px;margin-right: 20px" >
                                <div class="next-table-cell-wrapper">所在地区</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell">
                                <div class="next-table-cell-wrapper">详细地址</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell">
                                <div class="next-table-cell-wrapper">邮编</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell">
                                <div class="next-table-cell-wrapper">电话/手机</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell">
                                <div class="next-table-cell-wrapper">操作</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node" role="gridcell">
                                <div class="next-table-cell-wrapper"></div>
                            </th>
                        </tr>
                        </thead>
                        <tbody class="next-table-body" id="addressInfo">

                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
</div>
    </div>
</div>


<!-- self_info -->

<footer class="mt20 center">
    <!--<div class="mt20">小米商城|MIUI|米聊|多看书城|小米路由器|视频电话|小米天猫店|小米淘宝直营店|小米网盟|小米移动|隐私政策|Select Region</div>-->
    <div>©mi.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2014]0059-0009号</div>
    <div>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</div>
</footer>

<a onclick="edit(id)"></a>


<script>


    $(function () {
        //引入导航栏
        $("#head").load("header.html");
    })

    function editAddress(id) {
        // alert(id);
        var url="address_edit.html?id="+id;
        window.location.href=url;
    }

    //获取用户id
    // var userId;
    // function getUserId() {
    //     userId=window.location.search.split("=")[1]
    //     // alert(userId)
    // }
    // getUserId();
    //根据id获取用户信息
    function getUserInfoById() {
        $.ajax({
            url:'/userInfoById_',
            type:'GET', //GET
            contentType:"application/json",
            dataType:'json',
            success:function(data){
                $("#uid").val(data.id);


                //    获取用户所有地址
                $.ajax({
                    url:"/addressById",
                    type:'GET', //GET
                    contentType:"application/json",
                    // data:JSON.stringify({keys:key}),
                    dataType:'json',
                    success:function(data){
                        console.log(data)
                        var addressInfo = $("#addressInfo");
                        addressInfo.find("tr").remove();

                        var addressList=$("#addressList");
                        $(data).each(function (index,item) {
                            var trHtml=" <tr class=\"next-table-row first\" role=\"row\">" +
                                "<td type=\"body\" class=\"next-table-cell first\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">"+item.name+"</div>" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<span>"+item.province+" "+item.city+" "+item.region+"</span>" +
                                "</div>\n" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">"+item.detail_address+"</div>" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">"+item.post_code+"</div>\n" +
                                "</td><td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<span>"+item.phone_number+"<br>\n" +
                                "</span>\n" +
                                "</div>\n" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<div class=\"tAction\">\n" +
                                "<a class=\"t-change\""+ "onclick=\"editAddress("+item.id+")\"" +"target=\"_self\">修改</a>\n" +
                                "<span class=\"t-line\">|</span>\n" +
                                "<a class=\"t-change\""+ "onclick=\"deleteAddress("+item.id+")\"" +"target=\"_self\">删除</a>\n" +
                                "</div>\n" +
                                "</div>\n" +
                                "</td>\n"
                                // addressList.append(trHtml);
                            if (item.default_status=='1') {

                                var defaultAddress = "<td type=\"body\" class=\"next-table-cell last\" role=\"gridcell\">\n" +
                                    "<div class=\"next-table-cell-wrapper\">\n" +
                                    "<div><span class=\"t-default\" >默认地址</span>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</td>\n" +
                                "</tr><br/><br/>"
                                trHtml+=defaultAddress
                                // addressList.append(defaultAddress);
                                addressList.append(trHtml)
                            }else {
                                var notDefault="<td type=\"body\" class=\"next-table-cell last\" role=\"gridcell\">\n" +
                                    "<div class=\"next-table-cell-wrapper\">\n" +
                                    "<div>"+
                                    "<a class=\"t-change\""+ "onclick=\"setDefault("+item.id+")\"" +"target=\"_self\">设置为默认地址</a>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</td>\n" +
                                "</tr><br/><br/>"
                                // addressList.append(notDefault);
                                // console.log(addressList)
                                trHtml+=notDefault
                                addressList.append(trHtml)

                            }
                        })
                    },
                    error:function(data){
                        console.error(data);
                    }
                })


            },
            error:function(data){
                console.error(data);
            }
        })
    }
    getUserInfoById();


    var pass=false;
    //失去焦点判断手机号是否符合规则
    $("#phone_number").blur(function () {
        var reg=/^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\d{8}$/
        var p=$("#phone_number").val()
        if (!reg.test(p)){
            alert("手机号输入不符合规则")
        }else {
            pass=true;
        }
    });

    //删除一个地址
    function deleteAddress(id) {
        alert("删除")
        alert(id)

        $.ajax({
            url:"/deleteOneAddress?id="+id,
            type:'POST', //GET
            // data:JSON.stringify({id:id}),
            contentType:"application/json",
            dataType:'json',   //返回的数据格式：json/xml/html/script/jsonp/text
            success:function(data){
                console.log(data)
                if (data) {
                    alert("删除成功")
                    window.location.href = "address.html"
                }
            },
            error:function(data){
                console.log(data)
                alert("删除失败")
                window.location.href = "address.html"

            }
        })

    }


    // 提交表中信息

    function addAddress() {
        if ($("#province").val().trim() != '' &&
            $("#city").val().trim() != '' &&
            $("#region").val().trim() != '' &&
            $("#detail_address").val().trim() != '' &&
            $("#name").val().trim() != '' &&
            $("#phone_number").val().trim() != ''
        ) {
            $.ajax({
                url:'/addAddress',
                type:'POST',
                contentType:"application/json",
                data:JSON.stringify({
                    province: $("#province").val(),
                    city:$("#city").val(),
                    region:$("#region").val(),
                    member_id:$("#uid").val(),
                    detail_address:$("#detail_address").val(),
                    post_code:$("#post_code").val(),
                    name:$("#name").val(),
                    phone_number:$("#phone_number").val(),
                    default_status:0

                }),
                dataType:'json',   //返回的数据格式：json/xml/html/script/jsonp/text
                success:function(data){
                    alert(data)
                    console.log(data)
                    if (data) {
                        var url= "address.html"
                        window.location.href = url
                    }
                },
                error:function(data){
                    if (!data) {
                        var url= "address.html"
                        window.location.href = url                }}
            })
        }else {
            alert("地址输入不合法")
            return false;
        }
    }

//    设置默认地址
    function setDefault(id) {
        alert("设置")
        alert(id)
        $.ajax({
            url:'/setDefault?id='+id,
            type:'POST', //GET
            contentType:"application/json",
            // data:JSON.stringify({addressId:id}),
            dataType:'json',
            success:function(data){
                alert(data)
                console.log(data)
                if (data) {
                    var url= "address.html"
                    window.location.href = url
                }
            },
            error:function(data){
                console.log(data);
            }
        })

    }




</script>
</body>
</html>