<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="author" content="order by dede58.com"/>
    <title>Mutual商城-个人中心</title>
    <link rel="stylesheet" type="text/css" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/bootstrap/js/bootstrap.min.js">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap-fileinput.css">
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap-fileinput.js"></script>


</head>

<style>
    .gzxx {
        font-size: 12px;
        font-weight: bold;
        color: rgb(117, 117, 117);
        width: 100px;
        display: inline-block
    }

</style>


<body>

<div id="header"></div>


<div class="banner_x center">
    <!--<a href="index.html" target="_blank"><div class="logo fl"></div></a>-->
    <div class="wdgwc fl ml40">新增地址:</div>
    <div class="wxts fl ml20"></div>
    <div class="dlzc fr"></div>
    <div class="clear"></div>
</div>
<div class="xiantiao"></div>


<div class="grzxbj">


    <div class="selfinfo center">

        <div id="liftMain"></div>


        <div class="rtcont fr" style="height: 500px">
            <!--<div class="grzlbt ml40" id="address">新增地址</div>-->
            <!--新增地址-->
            <div data-spm="1998049142" class="m-logistics g-box-base g-mb-set">
                <div class="s-content" style="height: 500px">
                    <ul class="lg-list">
                        <li class="lg-item">
                            <form>
                                <div hidden><input id="uid" hidden></div>

                                <div>
                                    <!--<fieldset>-->
                                    <form action="#">
                                        <label for="addr-show" hidden>您选择的是：
                                            <input type="text" value="" id="addr-show" hidden>
                                        </label>
                                        <br/>
                                        <br/><br/>
                                        <div class=" gzxx ml40" style="width: 550px">
                                            <span class="gzxx" style="padding-right: 30px">省市区：</span>

                                            <!--省份选择-->
                                            <select id="prov" onchange="showCity(this)">
                                                <option>=请选择省份=</option>
                                            </select>
                                            <!--城市选择-->
                                            <select id="city" onchange="showCountry(this)">
                                                <option>=请选择城市=</option>
                                            </select>

                                            <!--县区选择-->
                                            <select id="country" onchange="selecCountry(this)">
                                                <option>=请选择县区=</option>
                                            </select>
                                            <div hidden>
                                                <button type="button" class="btn met1" onClick="showAddr()"
                                                        id="button-show">确定
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                    <!--</fieldset>-->
                                </div>
                                <br/><br/>

                                <script src="../static/js/js/city.js"></script>
                                <script src="../static/js/js/method.js"></script>
                                <div class=" gzxx ml40" style="width: 550px">
                                    <span class="gzxx" style="padding-right: 30px">详细地址：</span>
                                    <textarea id="detail_address" style="resize: none" rows="3" cols="40"
                                              placeholder="请输入详细地址信息，如道路、门牌号、小区、楼栋号、单元等信息"></textarea>
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px">
                                    <span class="gzxx" style="padding-right: 30px">邮政编码：</span>
                                    <input type="text" id="post_code" style="height: 30px;width: 260px"
                                           placeholder="000000">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px">
                                    <span class="gzxx" style="padding-right: 30px">收货人姓名：</span>
                                    <input type="text" id="name" style="height: 30px;width: 260px" placeholder="吴**">
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px">
                                    <span class="gzxx" style="padding-right: 30px">收货人手机号码：</span>
                                    <input type="text" id="phone_number" style="height: 30px;width: 260px"
                                           placeholder="139****1435">
                                </div>
                                <br/><br/>
                                <div lass=" gzxx ml40">
                                    <span style="padding-right: 40px"></span>
                                    <button href="self_info_edit.html" onclick="addAddress()">保存</button>
                                </div>

                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            <!--遍历地址-->

        </div>
    </div>
</div>

<div>
    <div style="margin: auto;height: 500px;width:100%;margin-top: 450px">

        <div data-spm="1998049142" class="m-logistics g-box-base g-mb-set" style="margin: auto;width: 70%">

            <div class="addressList">
                <div class="next-table">
                    <table id="addressList" border="1" cellpadding="0">
                        <colgroup>
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                            <col style="width: 20%;">
                            <col style="width: 15%;">
                            <col style="width: 15%;">
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                        </colgroup>
                        <thead class="next-table-header">
                        <tr>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell" style="width: 60px">
                                <div class="next-table-cell-wrapper">收货人</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell" style="width: 150px;margin-right: 20px">
                                <div class="next-table-cell-wrapper">所在地区</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell">
                                <div class="next-table-cell-wrapper">详细地址</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell">
                                <div class="next-table-cell-wrapper">邮编</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell">
                                <div class="next-table-cell-wrapper">电话/手机</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell">
                                <div class="next-table-cell-wrapper">操作</div>
                            </th>
                            <th rowspan="1" type="header" class="next-table-cell next-table-header-node"
                                role="gridcell">
                                <div class="next-table-cell-wrapper">状态</div>
                            </th>
                        </tr>
                        </thead>
                        <tbody class="next-table-body" id="addressInfo">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<div style="float: left;height: 120px;width: 100%;margin-top: 30px">
    <div class="xiantiao"></div>
    <div style="margin-left: 30%;margin-top: 20px">
        <div class="mt20" style="margin: auto">
            mutual商城|MIUI|米聊|多看书城|mutual路由器|视频电话|mutual天猫店|mutual淘宝直营店|mutual网盟|mutual移动|隐私政策|Select Region
        </div>
        <div style="margin: auto">©mutual.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号
            京网文[2014]0059-0009号
        </div>
        <div style="margin: auto">违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</div>
    </div>
</div>


<script src="../static/js/js/jquery-3.2.1.js"></script>
<script>


    $("#header").load("header.html");
    $("#liftMain").load("liftMain.html");


    function editAddress(id) {
        // alert(id);
        var url = "address_edit.html?id=" + id;
        window.location.href = url;
    }

    //获取用户id
    // var userId;
    // function getUserId() {
    //     userId=window.location.search.split("=")[1]
    //     // alert(userId)
    // }
    // getUserId();
    //根据id获取用户信息
    function getUserInfoById() {
        $.ajax({
            url: '/userInfoById_',
            type: 'GET', //GET
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                $("#uid").val(data.id);


                //    获取用户所有地址
                $.ajax({
                    url: "/addressById",
                    type: 'GET', //GET
                    contentType: "application/json",
                    // data:JSON.stringify({keys:key}),
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                        var addressInfo = $("#addressInfo");
                        addressInfo.find("tr").remove();

                        var addressList = $("#addressList");
                        $(data).each(function (index, item) {
                            var trHtml = " <tr class=\"next-table-row first\" role=\"row\">" +
                                "<td type=\"body\" class=\"next-table-cell first\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">" + item.name + "</div>" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<span>" + item.province + " " + item.city + " " + item.region + "</span>" +
                                "</div>\n" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">" + item.detail_address + "</div>" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">" + item.post_code + "</div>\n" +
                                "</td><td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<span>" + item.phone_number + "<br>\n" +
                                "</span>\n" +
                                "</div>\n" +
                                "</td>\n" +
                                "<td type=\"body\" class=\"next-table-cell\" role=\"gridcell\">\n" +
                                "<div class=\"next-table-cell-wrapper\">\n" +
                                "<div class=\"tAction\">\n" +
                                "<a class=\"t-change\"" + "onclick=\"editAddress(" + item.id + ")\"" + "target=\"_self\">修改</a>\n" +
                                "<span class=\"t-line\">|</span>\n" +
                                "<a class=\"t-change\"" + "onclick=\"deleteAddress(" + item.id + ")\"" + "target=\"_self\">删除</a>\n" +
                                "</div>\n" +
                                "</div>\n" +
                                "</td>\n"
                            // addressList.append(trHtml);
                            if (item.default_status == '1') {

                                var defaultAddress = "<td type=\"body\" class=\"next-table-cell last\" role=\"gridcell\">\n" +
                                    "<div class=\"next-table-cell-wrapper\">\n" +
                                    "<div><span class=\"t-default\" >默认地址</span>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</td>\n" +
                                    "</tr><br/><br/>"
                                trHtml += defaultAddress
                                // addressList.append(defaultAddress);
                                addressList.append(trHtml)
                            } else {
                                var notDefault = "<td type=\"body\" class=\"next-table-cell last\" role=\"gridcell\">\n" +
                                    "<div class=\"next-table-cell-wrapper\">\n" +
                                    "<div>" +
                                    "<a class=\"t-change\"" + "onclick=\"setDefault(" + item.id + ")\"" + "target=\"_self\">设置为默认地址</a>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</td>\n" +
                                    "</tr><br/><br/>"
                                // addressList.append(notDefault);
                                // console.log(addressList)
                                trHtml += notDefault
                                addressList.append(trHtml)

                            }
                        })
                    },
                    error: function (data) {
                        console.error(data);
                    }
                })


            },
            error: function (data) {
                console.error(data);
            }
        })
    }

    getUserInfoById();


    var pass = false;
    //失去焦点判断手机号是否符合规则
    $("#phone_number").blur(function () {
        var reg = /^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\d{8}$/
        var p = $("#phone_number").val()
        if (!reg.test(p)) {
            alert("手机号输入不符合规则")
        } else {
            pass = true;
        }
    });

    //删除一个地址
    function deleteAddress(id) {
        alert("删除")
        alert(id)

        $.ajax({
            url: "/deleteOneAddress?id=" + id,
            type: 'POST', //GET
            // data:JSON.stringify({id:id}),
            contentType: "application/json",
            dataType: 'json',   //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data) {
                console.log(data)
                if (data) {
                    alert("删除成功")
                    window.location.href = "address.html"
                }
            },
            error: function (data) {
                console.log(data)
                alert("删除失败")
                window.location.href = "address.html"

            }
        })

    }


    // 提交表中信息

    function addAddress() {

        alert(provice[current.prov].name)
        alert(provice[current.prov]["city"][current.city].name)
        alert(provice[current.prov]["city"][current.city].districtAndCounty[current.country])
        alert($("#detail_address").val().trim())
        alert($("#receivename").val().trim())
        alert($("#phone_number").val().trim())

        // alert(provice[current.prov].name)
        // alert(provice[current.prov]["city"][current.city].name)
        // alert(provice[current.prov]["city"][current.city].districtAndCounty[current.country])

        if (provice[current.prov].name != "=请选择省份=" &&
            provice[current.prov]["city"][current.city].name != "=请选择城市=" &&
            provice[current.prov]["city"][current.city].districtAndCounty[current.country] != "=请选择县区=" &&
            $("#detail_address").val().trim() != '' &&
            $("#receivename").val().trim() != '' &&
            $("#phone_number").val().trim() != ''
        ) {
            $.ajax({
                url: '/addAddress',
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify({
                    province: provice[current.prov].name,
                    city: provice[current.prov]["city"][current.city].name,
                    region: provice[current.prov]["city"][current.city].districtAndCounty[current.country],
                    member_id: $("#uid").val(),
                    detail_address: $("#detail_address").val(),
                    post_code: $("#post_code").val(),
                    name: $("#receivename").val(),
                    phone_number: $("#phone_number").val(),
                    default_status: 0

                }),
                dataType: 'json',   //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data) {
                    // alert(data)
                    console.log(data)
                    if (data) {
                        var url = "address.html"
                        window.location.href = url
                    }
                },
                error: function (data) {
                    if (!data) {
                        var url = "address.html"
                        window.location.href = url
                    }
                }
            })
        } else {
            alert("地址输入不合法")
            return false;
        }
    }

    //    设置默认地址
    function setDefault(id) {
        alert("设置")
        alert(id)
        $.ajax({
            url: '/setDefault?id=' + id,
            type: 'POST', //GET
            contentType: "application/json",
            // data:JSON.stringify({addressId:id}),
            dataType: 'json',
            success: function (data) {
                alert(data)
                console.log(data)
                if (data) {
                    var url = "address.html"
                    window.location.href = url
                }
            },
            error: function (data) {
                console.log(data);
            }
        })

    }


</script>
</body>
</html>