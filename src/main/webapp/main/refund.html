<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="author" content="order by dede58.com"/>
    <title>Mutual商城-个人中心</title>
    <link rel="stylesheet" type="text/css" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap-fileinput.css">
    <script src="../static/js/js/jquery-3.2.1.js"></script>
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap-fileinput.js"></script>
    <link href="../static/css/p.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../static/plugins/basic.min.css" />
    <link rel="stylesheet" href="../static/plugins/dropzone.min.css" />
    <script src="../static/plugins/dropzone.min.js"></script>

</head>


<style>
    .gzxx {font-size: 12px;font-weight: bold;color:rgb(117,117,117);width: 100px;display: inline-block}

</style>


<body>

<!-- start header -->
<header id="header">


</header>
<!--end header -->
<!-- start banner_x -->
<div class="banner_x center">
    <a href="./index.html" target="_blank"><div class="logo fl"></div></a>
    <a href=""><div class="ad_top fl"></div></a>
    <div class="nav fl">
        <ul>
            <li><a href="">商城首页 </a></li>

        </ul>
    </div>
    <div class="search fr">
        <form action="" method="post">
            <div class="text fl">
                <input type="text" class="shuru"  placeholder="输入关键字查询宝贝">
            </div>
            <div class="submit fl">
                <input type="submit" class="sousuo" value="搜索"/>
            </div>
            <div class="clear"></div>
        </form>
        <div class="clear"></div>
    </div>
</div>
<!-- end banner_x -->
<!-- self_info -->
<div class="grzxbj">
    <div class="selfinfo center">
        <div class="lfnav fl" style="height: 700px">
            <div class="ddzx" style="height: 20px">个人中心</div>
            <div class="subddzx">
                <ul>
                    <li><a href="./self_info.html" >我的信息</a></li>
                    <li><a href="./self_info_edit.html">修改信息</a></li>
                    <li><a href="./self_info_pwd_edit.html">修改密码</a></li>
                    <li><a href="./coupon.html">优惠券</a></li>
                    <li><a href="./address.html">收货地址</a></li>
                    <li><a href="./point.html">我的积分</a></li>
                </ul>
            </div>
            <div class="ddzx" style="height: 20px">订单中心</div>
            <div class="subddzx">
                <ul>
                    <li><a href="./orders.html">我的订单</a></li>
                    <li><a href="./basket.html">我的购物车</a></li>
                    <li><a href="./favourite.html">我的收藏</a></li>
                    <li><a href="./footprint.html">我的足迹</a></li>
                </ul>
            </div>
        </div>
        <!--//===============================================================================-->
        <div class="rtcont fr" style="width: 978px;height: 700px;background: #fff">
            <div class="grzlbt ml40">退货申请</div>


            <div data-spm="1998049142" class="m-logistics g-box-base g-mb-set" >
                <div class="s-bar" >
                    <i></i>商品信息
                </div>
                <div class="s-content" style="height: 110px">
                    <ul class="lg-list">

                        <li class="lg-item">
                            <div class="item-info">
                                <img src=""  height="120" width="120" id="pic">
                                <!--图片显示不出来的时候显示商品名称-->
                            </div>
                            <div class="lg-info" style="width: 280px">
                                <p id="name">商品名</p>
                                <p id="attr">商品属性</p>
                            </div>
                            <div class="lg-info" style="width: 120px">
                                <p id="price">单价</p>
                            </div>
                            <div class="lg-info" style="width: 120px">
                                <p id="amount">数量</p>
                            </div>
                        </li>

                    </ul>

                </div>
                <br/><br/><br/>
                <div class="s-content" style="height: 650px">

                    <ul class="lg-list">
                        <li class="lg-item">
                            <form>
                                <div hidden><input id="uid" hidden ></div>
                                <div hidden><input id="pid" hidden></div>
                                <!--<div class=" gzxx ml40" style="width: 550px" >-->
                                <!--<span class="gzxx" style="padding-right: 30px">国家：</span>-->
                                <!--<input type="text" id="country" style="height: 30px;width: 260px" placeholder="country">-->
                                <!--</div>-->
                                <!--<br/><br/>-->
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">退货原因：</span>
                                    <!--<input type="text" id="reason" style="height: 30px;width: 260px" placeholder="province">-->
                                    <select style="width: 260px;height: 30px" id="reason">
                                        <!--<option value="1">请选择退款原因</option>-->
                                        <!--<option>虚假发货</option>-->
                                        <!--<option>快递问题</option>-->
                                        <!--<option>假冒品牌</option>-->
                                        <!--<option>质量问题</option>-->
                                        <!--<option>发错货</option>-->
                                        <!--<option>大小尺寸与描述不符</option>-->
                                        <!--<option>尺寸拍错不喜欢、效果不好</option>-->
                                        <!--<option>其它</option>-->


                                    </select>
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">退货数量：</span>

                                    <input id="min"  type="button" value="-" style="width: 20px"/>
                                    <input id="value"  type="text" value="1" style="width: 30px;" />
                                    <input id="add" type="button" value="+" style="width: 20px"/>
                                    <!--<span id="product_count" style="height: 30px;width: 260px;font-size: medium;color: #cf9236;font-weight: 900">2</span>-->
                                </div>
                                <br/><br/>
                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">货品单价：</span>
                                    <span id="product_real_price" style="height: 30px;width: 260px;font-size: medium;color: #cf9236;font-weight: 900"></span>
                                    <!--<input type="text" id="proof_pics" style="height: 30px;width: 260px" placeholder="region">-->
                                </div>
                                <br/><br/>

                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px" >描述：</span><br/>
                                    <textarea id="description" style="resize: none" rows="4" cols="100" placeholder="请详细描述退货原因"></textarea>
                                </div>
                                <br/><br/>

                                <div class=" gzxx ml40" style="width: 550px" >
                                    <span class="gzxx" style="padding-right: 30px">上传凭证：</span><br/>
                                    <div id="dropzoneDiv" class="dropzone" style="height: 200px;width: 250px" ></div>


                                    <!--<div id="dropzoneDiv" class="dropzone" style="height: 200px;width: 850px" ></div>-->

                                </div>
                                <br/><br/>


                                <div lass=" gzxx ml40">
                                    <span style="padding-right: 40px"></span>
                                    <button href="self_info_edit.html" onclick="submitInfo()" id="submit">确认退货</button>
                                </div>

                            </form>
                        </li>
                    </ul>



                </div>

            </div>







            <!--//=======================================================-->
        </div>
        <div class="clear"></div>
    </div>
</div>

<!-- self_info -->

<footer class="mt20 center">
    <div class="mt20">小米商城|MIUI|米聊|多看书城|小米路由器|视频电话|小米天猫店|小米淘宝直营店|小米网盟|小米移动|隐私政策|Select Region</div>
    <div>©mi.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2014]0059-0009号</div>
    <div>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</div>
</footer>


<script>


    $(function () {
        $("#header").load("header.html");
    })

    //获取退货商品id

    var product;
    function getProductId() {
        product=window.location.search.split("=")[1]
        alert("退货商品id "+product)
        $("#pid").val(product)

    }
    getProductId();

    //获取用户id

    function getUserInfoById() {
        $.ajax({
            url:'/userInfoById_',
            type:'GET', //GET
            contentType:"application/json",
            dataType:'json',
            success:function(data){
                $("#uid").val(data.id);
            },
            error:function(data){
                console.error(data);
            }
        })
    }
    getUserInfoById();

    //获取退货原因列表
    function getreasons() {
        $.ajax({
            url:'/getreasons',
            type:'GET', //GET
            contentType:"application/json",
            dataType:'json',
            success:function(data){
                var reasons = $("#reason");
                $(data).each(function (index,item) {
                    var o="<option>"+item.name+"</option>"
                    reasons.append(o)
                })
            },
            error:function(data){
                console.error(data);
            }
        })
    }
    getreasons();

    var max;
    //获取需要退货的商品信息
    function getProduct() {
        $.ajax({
            url:"/getRefundProduct?id="+product,
            type:'GET', //GET
            contentType:"application/json",
            dataType:'json',   //返回的数据格式：json/xml/html/script/jsonp/text
            success:function(data){
                console.log(data)
                $("#pic").attr("src",data.product_pic)
                $("#name").html(data.product_name)
                $("#attr").html(data.product_attr)
                $("#price").html("单价：￥"+data.real_amount)
                $("#amount").html("数量："+data.product_quantity)
                $("#product_real_price").html("￥ "+data.real_amount)
                max=data.product_quantity
            },
            error:function(data){
                console.log(data)

            }
        })

    }

    getProduct();

    //添加
    $("#add").click(function () {
        var value = $("#value").val();
        if(value < max){
            $("#value").val(parseInt(value)+1);
        }else{
            $("#value").val(max);
        }
    });

    //减少
    $("#min").click(function () {
        var value = $("#value").val();
        if(value > 1){
            $("#value").val(parseInt(value)-1);
        }else{
            $("#value").val(1);
        }
    });


    Dropzone.options.dropzoneDiv = {
        url: "/upload", // 文件提交地址
        method: "post",  // 也可用put
        paramName: "dropzFile", // 默认为file
        maxFiles: 1,// 一次性上传的文件数量上限
        maxFilesize: 2, // 文件大小，单位：MB
        acceptedFiles: ".jpg,.png,.jpeg", // 上传的类型
        addRemoveLinks: true,
        parallelUploads: 1,// 一次上传的文件数量
        //previewsContainer:"#preview", // 上传图片的预览窗口
        dictDefaultMessage: '拖动文件至此或者点击上传',
        dictMaxFilesExceeded: "您最多只能上传1个文件！",
        dictResponseError: '文件上传失败!',
        dictInvalidFileType: "文件类型只能是*.jpg,*.png,*.jpeg",
        dictFallbackMessage: "浏览器不受支持",
        dictFileTooBig: "文件过大上传文件最大支持.",
        dictRemoveLinks: "删除",
        dictCancelUpload: "取消",
        init: function () {
            this.on("addedfile", function (file) {
                // 上传文件时触发的事件
            });
            this.on("success", function (file, data) {
                // 上传成功触发的事件
            });
            this.on("error", function (file, data) {
                // 上传失败触发的事件
            });
            this.on("removedfile", function (file) {
                // 删除文件时触发的方法
            });
        }

    }


    function submitInfo() {
        alert("申请退货")
        console.log($("#pid").val())
        console.log($("#reason option:selected").val())
        console.log($("#value").val())
        console.log($("#description").val())
        console.log($("#uid").val())

        $.ajax({
            url:'/refundText',
            type:'POST',
            contentType:"application/json",
            data:JSON.stringify({
                id: $("#pid").val(),
                reason:$("#reason option:selected").val(),
                product_count:$("#value").val(),
                description:$("#description").val(),
            }),
            dataType:'json',   //返回的数据格式：json/xml/html/script/jsonp/text
            success:function(data){
                alert("申请成功")
                console.log(data)
                if (data) {
                    var url= "orders.html"
                    window.location.href = url
                }
            },
            error:function(data){
                alert("申请失败")
                var url= "refund.html?id="+product
                window.location.href = url

                }
        })

    }



</script>
</body>
</html>